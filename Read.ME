# âš½ KI-gestÃ¼tztes Liveticker-Redaktionssystem

Automatisierte Generierung von Liveticker-Texten mit Claude AI fÃ¼r FuÃŸballspiele.

## ğŸ¯ Ãœberblick

Dieses System importiert Live-FuÃŸballdaten von API-Football und generiert automatisch Ticker-Texte in verschiedenen Stilen (neutral, euphorisch, kritisch) mithilfe von Claude AI.

### Features

- âœ… Automatischer Import von Spielen, Teams und Events
- âœ… Live-Tracking von Spielereignissen (Tore, Karten, Wechsel)
- âœ… KI-gestÃ¼tzte Ticker-Generierung in 3 Stilen
- âœ… Echtzeit-Updates alle 5 Sekunden
- âœ… Multi-Liga-Support (Bundesliga, La Liga, etc.)
- âœ… Responsive Web-Interface

---

## ğŸ—ï¸ Architektur
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API-Football   â”‚ (Externe Daten)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚   n8n   â”‚ (Workflow-Automation)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PostgreSQL  â”‚ (Datenbank)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ FastAPI      â”‚ (Backend)
    â”‚ + Claude AI  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚  React  â”‚ (Frontend)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Tech Stack

### Backend
- **Python 3.12** - FastAPI Framework
- **PostgreSQL 15** - Datenbank
- **SQLAlchemy** - ORM
- **Anthropic Claude** - LLM fÃ¼r Textgenerierung

### Frontend
- **React 18** - UI Framework
- **Axios** - HTTP Client
- **CSS** - Styling

### Automation
- **n8n** - Workflow-Automation
- **API-Football** - Datenquelle

---

## ğŸš€ Installation & Setup

### Voraussetzungen
```bash
- Python 3.12+
- Node.js 18+
- PostgreSQL 15+
- Docker (fÃ¼r n8n)
- API-Football Account
- Anthropic API-Key
```

### 1. Repository klonen
```bash
git clone <repository-url>
cd Bachelorarbeit
```

### 2. PostgreSQL Setup
```bash
# PostgreSQL Container starten
docker run --name liveticker-db \
  -e POSTGRES_USER=liveticker_user \
  -e POSTGRES_PASSWORD=dev_password_123 \
  -e POSTGRES_DB=liveticker_dev \
  -p 5433:5432 \
  -d postgres:15

# DB-Schema wird automatisch beim Backend-Start erstellt
```

### 3. Backend Setup
```bash
cd backend

# Virtual Environment erstellen
python -m venv venv
source venv/bin/activate  # macOS/Linux
# oder: venv\Scripts\activate  # Windows

# Dependencies installieren
pip install -r requirements.txt

# .env Datei erstellen
cat > .env << EOL
DATABASE_URL=postgresql://liveticker_user:dev_password_123@localhost:5433/liveticker_dev
ANTHROPIC_API_KEY=your_api_key_here
ANTHROPIC_MODEL=claude-sonnet-4-20250514
EOL

# Backend starten
uvicorn app.main:app --reload
```

**Backend lÃ¤uft auf:** `http://localhost:8000`  
**API Docs:** `http://localhost:8000/api/docs`

### 4. Frontend Setup
```bash
cd frontend

# Dependencies installieren
npm install

# Frontend starten
npm start
```

**Frontend lÃ¤uft auf:** `http://localhost:3000`

### 5. n8n Setup
```bash
# n8n Container starten
docker run -it --rm \
  --name n8n \
  -p 5678:5678 \
  -v ~/.n8n:/home/node/.n8n \
  n8nio/n8n

# n8n Ã¶ffnen: http://localhost:5678

# API-Football Credentials anlegen:
# - Name: "Header Auth account"
# - Header Name: x-rapidapi-key
# - Header Value: <your_api_football_key>

# PostgreSQL Credentials anlegen:
# - Host: host.docker.internal (macOS/Windows) oder localhost
# - Port: 5433
# - Database: liveticker_dev
# - User: liveticker_user
# - Password: dev_password_123
```

### 6. Workflows importieren

**Import Teams:**
1. n8n Ã¶ffnen
2. Workflow importieren aus `n8n-workflows/import-teams.json`
3. API-Football Credentials zuweisen
4. AusfÃ¼hren

**Import Matches:**
1. Workflow importieren aus `n8n-workflows/import-matches.json`
2. Liga & Spieltag anpassen
3. AusfÃ¼hren

**Live Event Tracking:**
1. Workflow importieren aus `n8n-workflows/live-events.json`
2. Match-ID anpassen
3. Workflow aktivieren (lÃ¤uft alle 10 Sek)

---

## ğŸ“– Verwendung

### 1. Daten importieren
```bash
# 1. Teams importieren (einmalig)
n8n Workflow: "Import Teams" ausfÃ¼hren

# 2. Matches importieren
n8n Workflow: "Import Matches" ausfÃ¼hren
# Anpassen: Liga-ID (78 = Bundesliga), Spieltag

# 3. Events importieren
n8n Workflow: "Import Events" ausfÃ¼hren
# Anpassen: Match-ID
```

### 2. Live-Tracking starten
```bash
# n8n Workflow "Live Events" aktivieren
# - Match-ID des Live-Spiels eintragen
# - Workflow aktivieren (Toggle ON)
# - LÃ¤uft automatisch alle 10 Sekunden
```

### 3. Frontend verwenden
```
1. http://localhost:3000 Ã¶ffnen
2. Tab auswÃ¤hlen:
   - "ğŸ“‹ Ligen" - Ligenverwaltung
   - "ğŸ† Liveticker" - Live-Spielverfolgung
   - "â­ Favoriten" - Gespeicherte Favoriten
3. Liga auswÃ¤hlen (z.B. Bundesliga)
4. Saison und Liga-Saison-Kombination auswÃ¤hlen
5. Spieltag auswÃ¤hlen
6. Match auswÃ¤hlen â†’ Events werden angezeigt
7. Ticker generieren:
   - Klick auf "ğŸ“ Neutral" / "ğŸ‰ Euphorisch" / "ğŸ” Kritisch"
   - Claude AI generiert Ticker-Text in gewÃ¤hltem Stil
   - Text wird angezeigt
```

---

## ğŸ—‚ï¸ Projektstruktur
```
Bachelorarbeit/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/v1/          # API Endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ events.py
â”‚   â”‚   â”‚   â”œâ”€â”€ favorites.py
â”‚   â”‚   â”‚   â”œâ”€â”€ league_seasons.py    # NEU: Liga-Saison-Kombinationen
â”‚   â”‚   â”‚   â”œâ”€â”€ leagues.py
â”‚   â”‚   â”‚   â”œâ”€â”€ lineups.py
â”‚   â”‚   â”‚   â”œâ”€â”€ match_statistics.py
â”‚   â”‚   â”‚   â”œâ”€â”€ matches.py
â”‚   â”‚   â”‚   â”œâ”€â”€ player_statistics.py
â”‚   â”‚   â”‚   â”œâ”€â”€ seasons.py            # NEU: Saisons
â”‚   â”‚   â”‚   â”œâ”€â”€ teams.py
â”‚   â”‚   â”‚   â””â”€â”€ ticker_entries.py
â”‚   â”‚   â”œâ”€â”€ core/            # Config & DB
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”‚   â””â”€â”€ database.py
â”‚   â”‚   â”œâ”€â”€ models/          # SQLAlchemy Models
â”‚   â”‚   â”‚   â”œâ”€â”€ event.py
â”‚   â”‚   â”‚   â”œâ”€â”€ league.py                # NEU: separate Liga
â”‚   â”‚   â”‚   â”œâ”€â”€ league_season.py         # NEU: Liga-Saison Junction
â”‚   â”‚   â”‚   â”œâ”€â”€ lineup.py                # NEU: Aufstellungen
â”‚   â”‚   â”‚   â”œâ”€â”€ match.py
â”‚   â”‚   â”‚   â”œâ”€â”€ match_statistic.py       # NEU: Match-Statistiken
â”‚   â”‚   â”‚   â”œâ”€â”€ player_statistic.py      # NEU: Spieler-Statistiken
â”‚   â”‚   â”‚   â”œâ”€â”€ season.py                # NEU: Saisons
â”‚   â”‚   â”‚   â”œâ”€â”€ team.py
â”‚   â”‚   â”‚   â”œâ”€â”€ ticker_entry.py
â”‚   â”‚   â”‚   â””â”€â”€ user_favorite.py         # NEU: Favoriten
â”‚   â”‚   â”œâ”€â”€ repositories/    # Data Access Layer
â”‚   â”‚   â”œâ”€â”€ schemas/         # Pydantic Schemas
â”‚   â”‚   â”œâ”€â”€ services/        # Business Logic
â”‚   â”‚   â”‚   â””â”€â”€ llm_service.py
â”‚   â”‚   â””â”€â”€ main.py
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ .env
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ LiveTicker.js     # Hauptkomponente mit Tabs
â”‚   â”‚   â”œâ”€â”€ LiveTicker.css
â”‚   â”‚   â”œâ”€â”€ App.js
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â””â”€â”€ components/       # Wiederverwendbare Komponenten
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ public/
â”œâ”€â”€ n8n-workflows/
â”‚   â”œâ”€â”€ import-teams.json
â”‚   â”œâ”€â”€ import-matches.json
â”‚   â”œâ”€â”€ import-seasons.json         # NEU
â”‚   â”œâ”€â”€ import-league-seasons.json  # NEU
â”‚   â””â”€â”€ live-events.json
â””â”€â”€ README.md
```

---

## ğŸ”§ Konfiguration

### API-Football Liga-IDs
```
78  - Bundesliga (Deutschland)
39  - Premier League (England)
140 - La Liga (Spanien)
135 - Serie A (Italien)
61  - Ligue 1 (Frankreich)
```

### Ticker-Stile

- **Neutral:** Sachlich, objektiv
- **Euphorisch:** Begeistert, emotional
- **Kritisch:** Analytisch, hinterfragend

### LLM-Modelle
```python
# In .env
ANTHROPIC_MODEL=claude-sonnet-4-20250514  # Empfohlen
# Alternativen:
# - claude-opus-4-5-20251101 (Premium)
# - claude-haiku-4-5-20251001 (Schnell)
```

---

## ğŸ“Š Datenbank-Schema

Die Datenbank verwendet ein **normalisiertes Modell** mit separaten Tabellen fÃ¼r Ligen, Saisons und deren VerknÃ¼pfung.

### Leagues (Ligen)
```sql
id, external_id, name, country, logo_url, type, created_at, updated_at
```

### Seasons (Saisons)
```sql
id, year, start_date, end_date, current, created_at
```

### League Seasons (Liga-Saison-Kombinationen)
```sql
id, league_id (FK), season_id (FK), current_round, total_rounds
```
*Junktioniert Ligen und Saisons (z.B. Bundesliga 2025)*

### Matches (Spiele)
```sql
id, external_id, league_season_id (FK), home_team_id (FK), away_team_id (FK),
match_date, status, round, score_home, score_away, created_at, updated_at
```
*Verwendet `league_season_id` statt separate league/season Felder*

### Teams (Mannschaften)
```sql
id, external_id, name, code, logo_url, country, founded, 
venue_name, venue_capacity, created_at, updated_at
```

### Events (Spielereignisse)
```sql
id, match_id (FK), minute, extra_time, team_id (FK), player_id, 
player_name, assist_id, assist_name, type, detail, comments, created_at
```

### Ticker Entries (Ticker-Texte)
```sql
id, event_id (FK), text, style, llm_model, created_at
```

---

## ğŸ› Troubleshooting

### Backend startet nicht
```bash
# PostgreSQL Connection prÃ¼fen
psql -h localhost -p 5433 -U liveticker_user -d liveticker_dev

# .env Datei prÃ¼fen
cat backend/.env
```

### Events kommen nicht an
```bash
# DB prÃ¼fen
SELECT COUNT(*) FROM events WHERE match_id = X;

# n8n Executions prÃ¼fen (Workflow Fehler?)
# API-Football Credits prÃ¼fen (Limit erreicht?)
```

### Ticker werden nicht generiert
```bash
# ANTHROPIC_API_KEY in .env gesetzt?
# Backend Logs prÃ¼fen:
# "âš ï¸  LLM Service lÃ¤uft im MOCK-Modus" â†’ API-Key fehlt!
```

### Frontend lÃ¤dt nicht
```bash
# Backend erreichbar?
curl http://localhost:8000/health

# CORS-Fehler? â†’ Backend .env prÃ¼fen
```

---

## ğŸ“ API-Endpunkte

### Leagues (Ligen)
```
GET    /api/v1/leagues/                       - Alle Ligen
GET    /api/v1/leagues/{league_id}            - Liga nach ID
GET    /api/v1/leagues/{league_id}/seasons    - Alle Saisons einer Liga
POST   /api/v1/leagues/                       - Liga erstellen
PATCH  /api/v1/leagues/{league_id}            - Liga aktualisieren
DELETE /api/v1/leagues/{league_id}            - Liga lÃ¶schen
```

### Seasons (Saisons)
```
GET    /api/v1/seasons/                  - Alle Saisons
GET    /api/v1/seasons/{season_id}       - Saison nach ID
POST   /api/v1/seasons/                  - Saison erstellen
PATCH  /api/v1/seasons/{season_id}       - Saison aktualisieren
```

### League Seasons (Liga-Saison-Kombinationen)
```
GET    /api/v1/league-seasons/                           - Alle Liga-Saison-Kombinationen
GET    /api/v1/league-seasons/{league_season_id}         - Kombination nach ID
GET    /api/v1/league-seasons/{league_season_id}/matches - Matches einer Liga-Saison
GET    /api/v1/league-seasons/{league_season_id}/rounds  - Alle Spieltage einer Liga-Saison
POST   /api/v1/league-seasons/                           - Kombination erstellen
PATCH  /api/v1/league-seasons/{league_season_id}         - Kombination aktualisieren
```

### Teams (Mannschaften)
```
GET    /api/v1/teams/                - Alle Teams
GET    /api/v1/teams/{id}            - Team nach ID
POST   /api/v1/teams/                - Team erstellen
PATCH  /api/v1/teams/{id}            - Team aktualisieren
```

### Matches (Spiele)
```
GET    /api/v1/matches/                            - Alle Matches
GET    /api/v1/matches/{id}                        - Match nach ID
GET    /api/v1/matches?league_season_id=X          - Matches einer Liga-Saison
GET    /api/v1/matches?team_id=X                   - Matches eines Teams
GET    /api/v1/matches?league_season_id=X&round=X  - Matches eines Spieltags
POST   /api/v1/matches/                            - Match erstellen
PATCH  /api/v1/matches/{id}                        - Match aktualisieren
```

### Events (Spielereignisse)
```
GET    /api/v1/events/                     - Alle Events
GET    /api/v1/events/{id}                 - Event nach ID
GET    /api/v1/events?match_id=X           - Events eines Matches
POST   /api/v1/events/                     - Event erstellen
PATCH  /api/v1/events/{id}                 - Event aktualisieren
DELETE /api/v1/events/{id}                 - Event lÃ¶schen
```

### Ticker Entries (Ticker-Texte)
```
GET    /api/v1/ticker-entries/                    - Alle Ticker-EintrÃ¤ge
GET    /api/v1/ticker-entries/{id}                - Eintrag nach ID
GET    /api/v1/ticker-entries?match_id=X          - Ticker eines Matches
POST   /api/v1/ticker-entries/generate/{event_id} - Ticker-Text generieren
       Query: ?style=neutral|euphorisch|kritisch
POST   /api/v1/ticker-entries/                    - Ticker-Eintrag erstellen
PATCH  /api/v1/ticker-entries/{id}                - Ticker-Eintrag aktualisieren
```

---

## ğŸ” Sicherheit

**Produktions-Deployment:**
```bash
# .env anpassen
DATABASE_URL=postgresql://user:pass@prod-host:5432/liveticker_prod
ANTHROPIC_API_KEY=sk-ant-...
CORS_ORIGINS=https://your-domain.com

# Secrets nicht committen!
echo ".env" >> .gitignore
```

---

## ğŸ“„ Lizenz

Bachelorarbeit - Eintracht Frankfurt / EintrachtTech GmbH

---

## ğŸ‘¤ Autor

**Jonas Kimmer**  
Werkstudent EintrachtTech GmbH  
Wirtschaftsinformatik Bachelor, 9. Semester

---

## ğŸ™ Danksagung

- API-Football fÃ¼r Datenquelle
- Anthropic fÃ¼r Claude AI
- n8n fÃ¼r Workflow-Automation





